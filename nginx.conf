# events {
#     worker_connections 1024;
# }

# http {
#     server {
#         listen 80;
#         server_name test-esxz.onrender.com;

#         location / {
#             root /usr/share/nginx/html;
#             index index.html;
#             try_files $uri $uri/ =404;
#             add_header Access-Control-Allow-Origin *;
#             add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
#             add_header Access-Control-Allow-Headers 'Authorization, Content-Type, X-Requested-With';
#             if ($request_method = OPTIONS) {
#             return 204;
#             }
#         }

#         location /canva/ {
#             proxy_pass https://www.canva.com/;
#             proxy_set_header Host www.canva.com;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header X-Forwarded-Proto $scheme;
#         }
#     }
# }

events {
    worker_connections 1024;
}

http {
    server {
        listen 80;
        listen 443 ssl;

        # Set the server name to match the Render URL
        server_name test-esxz.onrender.com;

        # SSL configuration (optional for development, but recommended for production)
        ssl_certificate /etc/nginx/ssl/certificate.crt;
        ssl_certificate_key /etc/nginx/ssl/certificate.key;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers 'TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384';
        ssl_prefer_server_ciphers on;

        # Main location block
        location / {
            proxy_pass http://localhost:3000;  # Forward requests to the Node.js server running on port 3000
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Proxy requests for /canva/ path
        location /canva/ {
            proxy_pass https://www.canva.com/;
            proxy_set_header Host www.canva.com;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Error pages
        error_page 502 503 504 /50x.html;
        location = /50x.html {
            root /usr/share/nginx/html;
        }
    }
}

